define(["jquery","ko","uiComponent"],function(t,a,e){"use strict";return e.extend({defaults:{template:"Mageants_Orderattachment/attachment-markup"},attachmentList:a.observableArray([]),initialize:function(){this._super();this.attachementData=this.dataconfig;this.attachementData.quoteData;this.allowedExtensions=this.attachementData.AttachmentExt,this.maxFileSize=this.attachementData.AttachmentSize,this.removeItem=this.attachementData.removeItem,this.maxFileLimit=this.attachementData.AttachmentLimit,this.invalidExtError=this.attachementData.AttachmentInvalidExt,this.invalidSizeError=this.attachementData.AttachmentInvalidSize,this.invalidLimitError=this.attachementData.AttachmentInvalidLimit,this.uploadUrl=this.attachementData.AttachmentUpload,this.updateUrl=this.attachementData.AttachmentUpdate,this.removeUrl=this.attachementData.AttachmentRemove,this.comment=this.attachementData.AttachmentComment,this.attachments=this.attachementData.attachments,this.attachmentTitle=this.attachementData.AttachmentTitle,this.attachmentInfromation=this.attachementData.AttachmentInfromation,this.attachmentList(this.attachments),this.files=this.attachementData.totalCount},showRowLoader:function(){t("body").trigger("processStart")},hideRowLoader:function(){t("body").trigger("processStop")},processingFile:function(t){var a=this.validateFile(t);if(a)this.addError(a);else if(this.files>=this.maxFileLimit)this.addError(this.invalidLimitError);else{var e=Math.random().toString(32).slice(2);this.upload(t,e)}},upload:function(a,e){var i=new FormData,n=this;this.showRowLoader(),i.append(t("#order-attachment").attr("name"),a),window.FORM_KEY&&i.append("form_key",window.FORM_KEY),t.ajax({url:this.uploadUrl,type:"POST",data:i,success:function(t){var a=JSON.parse(t);n.attachments.push(a),n.attachmentList(n.attachments),a.attachment_count&&(n.files=a.attachment_count),n.hideRowLoader()},error:function(t,a,e){n.addError(e),n.hideRowLoader()},cache:!1,contentType:!1,processData:!1})},updateComment:function(a,e,i){var n=t("#"+i).val();if(t.trim(n)){var r={attachment:a,hash:e,comment:n,form_key:window.FORM_KEY},o=this;this.showRowLoader(),t.ajax({url:this.updateUrl,type:"post",data:t.param(r),success:function(t){var a=JSON.parse(t);a.success?a.attachment_count&&(o.files=a.attachment_count):o.addError(a.error),o.hideRowLoader()},error:function(t,a,e){o.addError(e),o.hideRowLoader()}})}},deleteFile:function(a,e){var i={attachment:a,hash:e,form_key:window.FORM_KEY},n=this;n.showRowLoader(),t.ajax({url:this.removeUrl,type:"post",data:t.param(i),success:function(a){var i=JSON.parse(a);i.success&&(i.attachment_count&&(n.files=i.attachment_count),t('div.attachment-row[rel="'+e+'"]').remove()),n.hideRowLoader()},error:function(t,a,e){n.addError(e),n.hideRowLoader()}})},downloadFile:function(){window.location=this.download},validateFile:function(t){return this.checkFileExtension(t)?this.checkFileSize(t)?null:this.invalidSizeError:this.invalidExtError},checkFileExtension:function(a){var e=a.name.split(".").pop().toLowerCase(),i=this.allowedExtensions.split(",");return-1!=t.inArray(e,i)},checkFileSize:function(t){return!(t.size/1024>this.maxFileSize)},addError:function(a){var e;e='<div class="attachment-error danger"><strong class="close">X</strong>'+a+"</div>",t(".attachment-container").before(e),t(".attachment-error .close").on("click",function(){var a=t(this).closest("div");a.hasClass("attachment-error")&&t(a).slideUp("slow",function(){t(this).remove()})})},getTitle:function(){return console.log("this.attachmentTitle"),console.log(this.attachmentTitle),this.attachmentTitle},getAttachmentInfo:function(){return this.attachmentInfromation},selectFiles:function(){t("#order-attachment").trigger("click")},fileUpload:function(t,a){for(var e=a.target.files,i=0;i<e.length;i++)this.processingFile(e[i])},dragEnter:function(t,a){},dragOver:function(t,a){},drop:function(a,e){t(".order-attachment-drag-area").css("border","2px dashed #1979c3");var i=e.originalEvent.dataTransfer.files;console.log(i);for(var n=0;n<i.length;n++)this.processingFile(i[n])}})});