define(["jquery","ko","uiComponent"],function(t,e,a){"use strict";return a.extend({defaults:{template:"Mageants_Orderattachment/attachment-markup"},attachmentList:e.observableArray([]),initialize:function(){this._super();this.attachementData=this.dataconfig;this.attachementData.quoteData;this.allowedExtensions=this.attachementData.AttachmentExt,this.maxFileSize=this.attachementData.AttachmentSize,this.isCustomerAllow=this.attachementData.isCustomerAllow,this.removeItem=this.attachementData.removeItem,this.maxFileLimit=this.attachementData.AttachmentLimit,this.invalidExtError=this.attachementData.AttachmentInvalidExt,this.invalidSizeError=this.attachementData.AttachmentInvalidSize,this.invalidLimitError=this.attachementData.AttachmentInvalidLimit,this.uploadUrl=this.attachementData.AttachmentUpload,this.adminEmail=this.attachementData.adminEmail,this.updateUrl=this.attachementData.AttachmentUpdate,this.removeUrl=this.attachementData.AttachmentRemove,this.comment=this.attachementData.AttachmentComment,this.attachments=this.attachementData.attachments,this.attachmentTitle=this.attachementData.AttachmentTitle,this.attachmentInfromation=this.attachementData.AttachmentInfromation,this.attachmentList(this.attachments),this.files=this.attachementData.totalCount},sendmail:function(){var e=this.adminEmail;this.showRowLoader(),self=this,t.ajax({type:"POST",success:function(){window.location.href=e,self.hideRowLoader(),window.scroll({top:0});self.updateCommentMessage(" Your Attachments Are Delievered to the Admin Succefully")},error:function(t,e,a){self.hideRowLoader(),window.scroll({top:0});self.updateCommentMessage("Your Attachments Are Not Delievered to the Admin ")},cache:!1,contentType:!1,processData:!1})},showRowLoader:function(){t("body").trigger("processStart")},hideRowLoader:function(){t("body").trigger("processStop")},processingFile:function(t){var e=this.validateFile(t);if(e)this.addError(e);else if(this.attachments.length>=this.maxFileLimit)this.addError(this.invalidLimitError);else{var a=Math.random().toString(32).slice(2);this.upload(t,a)}},upload:function(e,a){var n=new FormData,i=this;this.showRowLoader(),n.append(t("#order-attachment").attr("name"),e),window.FORM_KEY&&n.append("form_key",window.FORM_KEY),t.ajax({url:this.uploadUrl,type:"POST",data:n,success:function(t){var e=JSON.parse(t);i.attachments.push(e),i.attachmentList(i.attachments),e.attachment_count&&(i.files=e.attachment_count),i.hideRowLoader()},error:function(t,e,a){i.addError(a),i.hideRowLoader()},cache:!1,contentType:!1,processData:!1})},updateComment:function(e,a,n){var i=t("#"+n).val();if(t.trim(i)){var o={attachment:e,hash:a,comment:i,form_key:window.FORM_KEY},r=this;this.showRowLoader(),t.ajax({url:this.updateUrl,type:"post",data:t.param(o),success:function(t){var e=JSON.parse(t);e.success?e.attachment_count&&(r.files=e.attachment_count):r.addError(e.error),r.hideRowLoader(),window.scroll({top:0});r.updateCommentMessage("Succefully Comments added for Attachment")},error:function(t,e,a){r.addError(a),r.hideRowLoader()}})}},deleteFile:function(e,a){var n={attachment:e,hash:a,form_key:window.FORM_KEY},i=this;i.showRowLoader(),t.ajax({url:this.removeUrl,type:"post",data:t.param(n),success:function(e){var n=JSON.parse(e);n.success&&(n.attachment_count&&(i.files=n.attachment_count),t('div.attachment-row[rel="'+a+'"]').remove()),i.hideRowLoader()},error:function(t,e,a){i.addError(a),i.hideRowLoader()}})},downloadFile:function(){window.location=this.download},validateFile:function(t){return this.checkFileExtension(t)?this.checkFileSize(t)?null:this.invalidSizeError:this.invalidExtError},checkFileExtension:function(e){var a=e.name.split(".").pop().toLowerCase(),n=this.allowedExtensions.split(",");return-1!=t.inArray(a,n)},checkFileSize:function(t){return!(t.size/1024>this.maxFileSize)},addError:function(e){var a=null;document.querySelector(".attachment-error.danger")?(t(".attachment-error.danger").remove(),a='<div class="attachment-error danger"><strong class="close">X</strong>'+e+"</div>",t(".attachment-container").before(a)):(a='<div class="attachment-error danger"><strong class="close">X</strong>'+e+"</div>",t(".attachment-container").before(a)),t(".attachment-error.danger").fadeOut(5e3)},updateCommentMessage:function(e){var a=null;document.querySelector(".attachment-msg.success1")?(t(".attachment-msg.success1").remove(),a='<div class="attachment-msg success1">'+e+"</div>",t(".page-main").before(a)):(a='<div class="attachment-msg success1">'+e+"</div>",t(".page-main").before(a)),t(".attachment-msg.success1").fadeOut(5e3)},getTitle:function(){return console.log("this.attachmentTitle"),console.log(this.attachmentTitle),this.attachmentTitle},getAttachmentInfo:function(){return this.attachmentInfromation},selectFiles:function(){t("#order-attachment").trigger("click")},fileUpload:function(t,e){for(var a=e.target.files,n=0;n<a.length;n++)this.processingFile(a[n])},dragEnter:function(t,e){},dragOver:function(t,e){},drop:function(e,a){t(".order-attachment-drag-area").css("border","2px dashed #1979c3");var n=a.originalEvent.dataTransfer.files;console.log(n);for(var i=0;i<n.length;i++)this.processingFile(n[i])}})});