define(["jquery","ko","uiComponent"],function(t,e,i){"use strict";return i.extend({defaults:{template:"Mageants_Orderattachment/order/shipment/attachment-markup"},attachmentList:e.observableArray([]),isVisible:window.checkoutConfig.AttachmentEnabled,initialize:function(){this._super();window.checkoutConfig.quoteData;this.allowedExtensions=window.checkoutConfig.AttachmentExt,this.maxFileSize=window.checkoutConfig.AttachmentSize,this.removeItem=window.checkoutConfig.removeItem,this.maxFileLimit=window.checkoutConfig.AttachmentLimit,this.invalidExtError=window.checkoutConfig.AttachmentInvalidExt,this.invalidSizeError=window.checkoutConfig.AttachmentInvalidSize,this.invalidLimitError=window.checkoutConfig.AttachmentInvalidLimit,this.uploadUrl=window.checkoutConfig.AttachmentUpload,this.updateUrl=window.checkoutConfig.AttachmentUpdate,this.removeUrl=window.checkoutConfig.AttachmentRemove,this.comment=window.checkoutConfig.AttachmentComment,this.attachments=window.checkoutConfig.attachments,this.attachmentTitle=window.checkoutConfig.AttachmentTitle,this.attachmentInfromation=window.checkoutConfig.AttachmentInfromation,this.attachmentList(this.attachments),this.files=window.checkoutConfig.totalCount},showRowLoader:function(){t("body").trigger("processStart")},hideRowLoader:function(){t("body").trigger("processStop")},processingFile:function(t){var e=this.validateFile(t);if(e)this.addError(e);else if(this.files>=this.maxFileLimit)this.addError(this.invalidLimitError);else{var i=Math.random().toString(32).slice(2);this.upload(t,i)}},upload:function(e,i){var n=new FormData,o=this;this.showRowLoader(),n.append(t("#order-attachment").attr("name"),e),window.FORM_KEY&&n.append("form_key",window.FORM_KEY),t.ajax({url:this.uploadUrl,type:"POST",data:n,success:function(t){var e=JSON.parse(t);o.attachments.push(e),o.attachmentList(o.attachments),e.attachment_count&&(o.files=e.attachment_count),o.hideRowLoader()},error:function(t,e,i){o.addError(i),o.hideRowLoader()},cache:!1,contentType:!1,processData:!1})},updateComment:function(e,i,n){var o=t("#"+n).val();if(t.trim(o)){var a={attachment:e,hash:i,comment:o,form_key:window.FORM_KEY},r=this;this.showRowLoader(),t.ajax({url:this.updateUrl,type:"post",data:t.param(a),success:function(t){var e=JSON.parse(t);e.success?e.attachment_count&&(r.files=e.attachment_count):r.addError(e.error),r.hideRowLoader()},error:function(t,e,i){r.addError(i),r.hideRowLoader()}})}},deleteFile:function(e,i){var n={attachment:e,hash:i,form_key:window.FORM_KEY},o=this;o.showRowLoader(),t.ajax({url:this.removeUrl,type:"post",data:t.param(n),success:function(e){var n=JSON.parse(e);n.success&&(n.attachment_count&&(o.files=n.attachment_count),t('div.attachment-row[rel="'+i+'"]').remove()),o.hideRowLoader()},error:function(t,e,i){o.addError(i),o.hideRowLoader()}})},validateFile:function(t){return this.checkFileExtension(t)?this.checkFileSize(t)?null:this.invalidSizeError:this.invalidExtError},checkFileExtension:function(e){var i=e.name.split(".").pop().toLowerCase(),n=this.allowedExtensions.split(",");return-1!=t.inArray(i,n)},checkFileSize:function(t){return!(t.size/1024>this.maxFileSize)},addError:function(e){var i=null;document.querySelector(".attachment-error.danger")?(t(".attachment-error.danger").remove(),i='<div class="attachment-error danger"><strong class="close">X</strong>'+e+"</div>",t(".attachment-container").before(i)):(i='<div class="attachment-error danger"><strong class="close">X</strong>'+e+"</div>",t(".attachment-container").before(i)),t(".attachment-error.danger").fadeOut(5e3)},getTitle:function(){return this.attachmentTitle},getAttachmentInfo:function(){return this.attachmentInfromation},selectFiles:function(){t("#order-attachment").trigger("click")},fileUpload:function(t,e){for(var i=e.target.files,n=0;n<i.length;n++)this.processingFile(i[n])},dragEnter:function(t,e){},dragOver:function(t,e){},drop:function(e,i){t(".order-attachment-drag-area").css("border","2px dashed #1979c3");var n=i.originalEvent.dataTransfer.files;console.log(n);for(var o=0;o<n.length;o++)this.processingFile(n[o])}})});