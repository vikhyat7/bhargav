define(["jquery","ko","uiComponent"],function(t,e,a){"use strict";return a.extend({defaults:{template:"Mageants_Orderattachment/attachment-markup"},attachmentList:e.observableArray([]),initialize:function(){this._super();this.attachementData=this.dataconfig;this.attachementData.quoteData;this.allowedExtensions=this.attachementData.AttachmentExt,this.maxFileSize=this.attachementData.AttachmentSize,this.isCustomerAllow=this.attachementData.isCustomerAllow,this.adminEmail=this.attachementData.adminEmail,console.log("this.customerAllow"),console.log(this.adminEmail),this.removeItem=this.attachementData.removeItem,this.maxFileLimit=this.attachementData.AttachmentLimit,this.invalidExtError=this.attachementData.AttachmentInvalidExt,this.invalidSizeError=this.attachementData.AttachmentInvalidSize,this.invalidLimitError=this.attachementData.AttachmentInvalidLimit,this.uploadUrl=this.attachementData.AttachmentUpload,this.updateUrl=this.attachementData.AttachmentUpdate,this.removeUrl=this.attachementData.AttachmentRemove,this.comment=this.attachementData.AttachmentComment,this.attachments=this.attachementData.attachments,this.attachmentTitle=this.attachementData.AttachmentTitle,this.attachmentInfromation=this.attachementData.AttachmentInfromation,this.attachmentList(this.attachments),this.files=this.attachementData.totalCount},showRowLoader:function(){t("body").trigger("processStart")},hideRowLoader:function(){t("body").trigger("processStop")},processingFile:function(t){var e=this.validateFile(t);if(e)this.addError(e);else if(this.files>=this.maxFileLimit)this.addError(this.invalidLimitError);else{var a=Math.random().toString(32).slice(2);this.upload(t,a)}},upload:function(e,a){var i=new FormData,n=this;this.showRowLoader(),i.append(t("#order-attachment").attr("name"),e),window.FORM_KEY&&i.append("form_key",window.FORM_KEY),t.ajax({url:this.uploadUrl,type:"POST",data:i,success:function(t){var e=JSON.parse(t);n.attachments.push(e),n.attachmentList(n.attachments),e.attachment_count&&(n.files=e.attachment_count),n.hideRowLoader()},error:function(t,e,a){n.addError(a),n.hideRowLoader()},cache:!1,contentType:!1,processData:!1})},updateComment:function(e,a,i){var n=t("#"+i).val();if(t.trim(n)){var s={attachment:e,hash:a,comment:n,form_key:window.FORM_KEY},o=this;this.showRowLoader(),t.ajax({url:this.updateUrl,type:"post",data:t.param(s),success:function(t){var e=JSON.parse(t);e.success?e.attachment_count&&(o.files=e.attachment_count):o.addError(e.error),o.hideRowLoader(),window.scroll({top:0});o.updateCommentMessage("Succefully Comments added for Attachment")},error:function(t,e,a){o.addError(a),o.hideRowLoader()}})}},deleteFile:function(e,a){var i={attachment:e,hash:a,form_key:window.FORM_KEY},n=this;n.showRowLoader(),t.ajax({url:this.removeUrl,type:"post",data:t.param(i),success:function(e){var i=JSON.parse(e);i.success&&(i.attachment_count&&(n.files=i.attachment_count),t('div.attachment-row[rel="'+a+'"]').remove()),n.hideRowLoader()},error:function(t,e,a){n.addError(a),n.hideRowLoader()}})},downloadFile:function(){window.location=this.download},validateFile:function(t){return this.checkFileExtension(t)?this.checkFileSize(t)?null:this.invalidSizeError:this.invalidExtError},checkFileExtension:function(e){var a=e.name.split(".").pop().toLowerCase(),i=this.allowedExtensions.split(",");return-1!=t.inArray(a,i)},checkFileSize:function(t){return!(t.size/1024>this.maxFileSize)},addError:function(e){var a=null;document.querySelector(".attachment-error.danger")||(a='<div class="attachment-error danger"><strong class="close">X</strong>'+e+"</div>",t(".attachment-container").before(a),t(".attachment-error .close").on("click",function(){var e=t(this).closest("div");e.hasClass("attachment-error")&&t(e).slideUp("slow",function(){t(this).remove()})}))},updateCommentMessage:function(e){var a=null;document.querySelector(".attachment-msg.success1")?(t(".attachment-msg.success1").remove(),a='<div class="attachment-msg success1">'+e+"</div>",t(".page-columns").before(a)):(a='<div class="attachment-msg success1">'+e+"</div>",t(".page-columns").before(a)),t(".attachment-msg.success1").fadeOut(5e3)},getTitle:function(){return console.log("this.attachmentTitle"),console.log(this.attachmentTitle),this.attachmentTitle},getAttachmentInfo:function(){return this.attachmentInfromation},selectFiles:function(){t("#order-attachment").trigger("click")},fileUpload:function(t,e){for(var a=e.target.files,i=0;i<a.length;i++)this.processingFile(a[i])},dragEnter:function(t,e){},dragOver:function(t,e){},drop:function(e,a){t(".order-attachment-drag-area").css("border","2px dashed #1979c3");var i=a.originalEvent.dataTransfer.files;console.log(i);for(var n=0;n<i.length;n++)this.processingFile(i[n])}})});